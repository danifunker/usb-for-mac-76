#ifndef ENDPOINTDESCRIPTOR_H#define ENDPOINTDESCRIPTOR_H/************************** * * Endpoint Descriptor (ED) * ***************************/#include <Endian.h>#include <MacTypes.h>#include "MemoryAlloc.h"#include <assert.h>#include <stdlib.h>#include <string.h>#define OHCI_ED_POOL_SIZE ( 256 )// Endpoint Descriptor Field flags// DWORD 0	(flags)#define OHCI_ED_USED	(1 << 31)#define OHCI_ED_FA		(1 << 0)#define OHCI_ED_EN		(1 << 7)#define OHCI_ED_D		(1 << 11)#define OHCI_ED_S		(1 << 13)#define OHCI_ED_K		(1 << 14)#define OHCI_ED_F		(1 << 15)#define OHCI_ED_MPS		(1 << 16)// DWORD 2 	(HeadP) flag bits#define OHCI_ED_H		(1 << 0)#define OHCI_ED_C		(1 << 1)typedef enum{	OHCI_FLOW_DEFER,	// specified in the TD	OHCI_FLOW_OUT,	OHCI_FLOW_IN} OHCI_FlowDirection;typedef struct ohci_general_transfer_descriptor_t OHCI_GeneralTD; // forward declaration// Endpoint Descriptor (section 4.2)// This is visible to the USB host controller via the DMA buffer.// Warning: Only LITTLE-ENDIAN data should be stored here!typedef struct ohci_endpoint_descriptor_t{	/*	// Private, unused by host controller	UInt32			used			: 1;	UInt32							: 4; 	// reserved		// Public, used by host controller	volatile UInt32	max_packet_size : 11;	volatile UInt32	is_isochronous	: 1;	volatile UInt32	skip			: 1;	volatile UInt32	speed			: 1;	volatile UInt32	direction		: 2;	volatile UInt32	endpoint_num	: 4;	volatile UInt32	function_addr 	: 7;	// Endpoint address.	*/	UInt32							flags;	OHCI_GeneralTD					*__TailP;		// TD Queue Tail Pointer	OHCI_GeneralTD					*__HeadP;		// TD Queue Head Pointer (plus flags)	ohci_endpoint_descriptor_t		*__NextED;	// Next Endpoint Descriptor} OHCI_ED;OHCI_ED *OHCI_ED_Create();void OHCI_ED_AttachTD(OHCI_ED *ed, OHCI_GeneralTD *td);void OHCI_ED_DumpInfo(OHCI_ED *ed);// Flag settersvoid OHCI_ED_SetUsed(OHCI_ED *ed, Boolean value);void OHCI_ED_SetFunctionAddress(OHCI_ED *ed, UInt8 value);void OHCI_ED_SetEndpointNumber(OHCI_ED *ed, UInt8 value);void OHCI_ED_SetDirection(OHCI_ED *ed, UInt8 value);void OHCI_ED_SetSpeed(OHCI_ED *ed, Boolean value);void OHCI_ED_SetSkip(OHCI_ED *ed, Boolean value);void OHCI_ED_SetFormat(OHCI_ED *ed, Boolean value);void OHCI_ED_SetMaxPacketSize(OHCI_ED *ed, UInt8 value);void OHCI_ED_SetHalted(OHCI_ED *ed, Boolean value);void OHCI_ED_SetToggleCarry(OHCI_ED *ed, Boolean value);// Flag gettersUInt32 	OHCI_ED_GetFlags(OHCI_ED *ed);Boolean OHCI_ED_GetHalted(OHCI_ED *ed);Boolean OHCI_ED_GetUsed(OHCI_ED *ed);UInt8	OHCI_ED_GetFunctionAddress(OHCI_ED *ed);OHCI_GeneralTD *OHCI_ED_GetTailP(OHCI_ED *ed);OHCI_GeneralTD *OHCI_ED_GetHeadP(OHCI_ED *ed);OHCI_ED *OHCI_ED_GetNextED(OHCI_ED *ed);void OHCI_ED_SetTailP(OHCI_ED *ed, OHCI_GeneralTD *td);void OHCI_ED_SetHeadP(OHCI_ED *ed, OHCI_GeneralTD *td);void OHCI_ED_SetNextED(OHCI_ED *ed, OHCI_ED *next);// Object pool routinesextern OHCI_ED *ohci_endpoint_descriptor_pool;UInt32 OHCI_ED_InitPool(LogicalAddress base);OHCI_ED *OHCI_ED_GetFree();#endif