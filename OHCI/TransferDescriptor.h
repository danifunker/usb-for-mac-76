#ifndef TRANSFERDESCRIPTOR_H#define TRANSFERDESCRIPTOR_H/************************** * * Transfer Descriptor (TD) * ***************************/ #include <string.h> #include <MacTypes.h>#include <assert.h>#include "MemoryAlloc.h" #define OHCI_TD_POOL_SIZE ( 1024 ) // Transfer descriptors must be 16-byte aligned. // DWORD 0 	(flags)#define OHCI_GTD_R		(1 << 18)#define OHCI_GTD_DP		(1 << 19)#define OHCI_GTD_DI		(1 << 21)#define OHCI_GTD_T		(1 << 24)#define OHCI_GTD_EC		(1 << 26)#define OHCI_GTD_CC		(1 << 28)// General Transfer Descriptor (section 4.3)typedef struct ohci_general_transfer_descriptor_t{	/*	// Public flags	volatile UInt32	condition_code	: 4;	volatile UInt32	error_count		: 2;	volatile UInt32	data_toggle		: 2;	UInt32	delay_interrupt			: 3;	UInt32	direction				: 2;			UInt32	buffer_rounding 		: 1;		// Private flags	UInt32	used					: 1;	UInt32	reserved 				: 17;	*/		UInt32 __flags;	// Pointers	volatile Ptr __CBP;										// Current Buffer Pointer	volatile ohci_general_transfer_descriptor_t *__NextTD;	// Next TD in queue	Ptr	__BE;													// Buffer End} OHCI_GeneralTD;typedef struct ohci_isochronous_transfer_descriptor_t{	UInt32 									flags;	ohci_isochronous_transfer_descriptor_t *NextTD;	Ptr										BufferEnd;	UInt16									packet[8];	// 8 packet addresses} OHCI_IsochronousTD;OHCI_GeneralTD *OHCI_GeneralTD_Create();void OHCI_GeneralTD_Init(OHCI_GeneralTD *td, int direction, Ptr buf, Size size);// Object pool routinesextern OHCI_GeneralTD *ohci_transfer_descriptor_pool;UInt32 OHCI_TD_InitPool(LogicalAddress base);OHCI_GeneralTD *OHCI_TD_GetFree();void OHCI_TD_DumpList(OHCI_GeneralTD *head);void OHCI_TD_SetCBP(OHCI_GeneralTD *td, Ptr cbp);void OHCI_TD_SetNextTD(OHCI_GeneralTD *td, OHCI_GeneralTD *next);void OHCI_TD_SetBE(OHCI_GeneralTD *td, Ptr be);Ptr OHCI_TD_GetCBP(OHCI_GeneralTD *td);Ptr OHCI_TD_GetBE(OHCI_GeneralTD *td);OHCI_GeneralTD *OHCI_TD_GetNextTD(OHCI_GeneralTD *td);// Flag settersvoid OHCI_TD_SetUsed(OHCI_GeneralTD *td, Boolean value);void OHCI_TD_SetConditionCode(OHCI_GeneralTD *td, UInt8 value);void OHCI_TD_SetErrorCount(OHCI_GeneralTD *td, UInt8 value);void OHCI_TD_SetDataToggle(OHCI_GeneralTD *td, UInt8 value);void OHCI_TD_SetDelayInterrupt(OHCI_GeneralTD *td, UInt8 value);void OHCI_TD_SetDirection(OHCI_GeneralTD *td, UInt8 value);void OHCI_TD_SetBufferRounding(OHCI_GeneralTD *td, Boolean value);// Flag gettersBoolean OHCI_TD_GetUsed(OHCI_GeneralTD *td);UInt8 OHCI_TD_GetConditionCode(OHCI_GeneralTD *td);UInt8 OHCI_TD_GetErrorCount(OHCI_GeneralTD *td);UInt8 OHCI_TD_GetDataToggle(OHCI_GeneralTD *td);UInt8 OHCI_TD_GetDelayInterrupt(OHCI_GeneralTD *td);UInt8 OHCI_TD_GetDirection(OHCI_GeneralTD *td);Boolean OHCI_TD_GetBufferRounding(OHCI_GeneralTD *td);// Flag getters#endif