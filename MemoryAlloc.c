#include "MemoryAlloc.h"#include ":OHCI:OHCI.h"void *MEM_AllocAlignedBlock(Size size, Size alignment){	void *ptr = MemAllocatePhysicallyContiguous(size + alignment, true);	ptr = (void *)((((UInt32)ptr) + alignment) & ~alignment);	return ptr;}void MEM_PrepareForDMA(OHCI_Device *device){	// Provide a physical-mapped region for DMA operations.	// Allocate 64KB to split between HCCA, ED, and TD.		const int dmaBufferBytes = 65536;	const int pageCount = dmaBufferBytes / 4096; // 4KB pages on PPC		PhysicalAddress physicalAddresses[pageCount];	PhysicalMappingTablePtr physicalAddressTable = physicalAddresses;			device->ioPrepTable.logicalMapping = 0;	device->ioPrepTable.physicalMapping = physicalAddresses;		device->ioPrepTable.addressSpace = kCurrentAddressSpaceID; // we're not on Copland	device->ioPrepTable.granularity = 0;	device->ioPrepTable.firstPrepared = 0;		device->ioPrepTable.mappingEntryCount = pageCount;		device->ioPrepTable.options = kIOLogicalRanges | kIOIsOutput;	device->ioPrepTable.rangeInfo.range.base = device->dma_base.logical;	device->ioPrepTable.rangeInfo.range.length = device->dma_base.length;	OSStatus result = PrepareMemoryForIO(&device->ioPrepTable);		device->dma_base.physical = physicalAddresses[0];}